import numpy as np
import pandas as pd

from source.IO.dataset_import.GenericLoader import GenericLoader
from source.environment.Constants import Constants


class OLGALoader(GenericLoader):
    '''
    Loads data generated by OLGA simulations into a RepertoireDataset containing SequenceRepertoires.
    '''

    def _read_preprocess_file(self, filepath, params):
        if params["has_header"]:
            df = pd.read_csv(filepath, header=0, sep="\t")
        else:
            if params["col_names"] in ([], None,):
                raise IOError("OLGALoader: No column names found. has_header was set to False and col_names is empty. ")

            df = pd.read_csv(filepath, header=None, names=params["col_names"], sep="\t")

        return self._add_minimal_info(df)

    def _add_minimal_info(self, df):
        '''The data frame should at least contain sequences or sequence_aas, and sequence_identifiers
        Unknown data is set to 'None' '''

        if not "sequences" in df.columns and not "sequence_aas" in df.columns:
            raise IOError("OLGALoader: Columns should contain at least 'sequences' or 'sequence_aas'. ")

        if not "sequences" in df.columns:
            df["sequences"] = None
        if not "sequence_aas" in df.columns:
            df["sequence_aas"] = None

        df["sequence_identifiers"] = None

        return df

